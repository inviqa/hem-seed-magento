version: '3'
services:
  web:
    build: .
    depends_on:
      - mysql
      - redis
      - memcached
    environment:
      ASSETS_S3_BUCKET: '<%= config.asset_bucket %>'
      ASSETS_ENV: development
      ASSETS_CLEANUP: 'false'
      AWS_ACCESS_KEY_ID:
      AWS_SECRET_ACCESS_KEY:
      DATABASE_NAME: magentodb
      DATABASE_USER: magento
      DATABASE_PASSWORD: magento
      DATABASE_HOST: mysql
    expose:
      - 80
      - 443
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - .:/app

  mysql:
    image: quay.io/continuouspipe/mysql5.7:stable
    environment:
      MYSQL_ROOT_PASSWORD: <%= config.tmp.mysql_root_password %>
      MYSQL_DATABASE: magentodb
      MYSQL_USER: magento
      MYSQL_PASSWORD: magento

  redis:
    image: quay.io/continuouspipe/redis3:stable

  memcached:
    image: quay.io/continuouspipe/memcached1.4:stable
